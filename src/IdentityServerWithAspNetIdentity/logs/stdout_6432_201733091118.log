dbug: IdentityServer4.Hosting.CookieMiddlewareExtensions[0]
      Using hosting application's CookieAuthentication middleware with scheme: Identity.Application
info: Microsoft.Extensions.DependencyInjection.DataProtectionServices[0]
      User profile is available. Using 'C:\Users\ThanhAdmin\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
Hosting environment: Development
Content root path: F:\projects\git\_vta.identityserver\src\IdentityServerWithAspNetIdentity
Now listening on: http://localhost:33488
Application started. Press Ctrl+C to shut down.
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[1]
      Request starting HTTP/1.1 GET http://localhost:5000/  
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[3]
      HttpContext.User merged via AutomaticAuthentication from authenticationScheme: Identity.Application.
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[8]
      AuthenticationScheme: Identity.Application was successfully authenticated.
info: Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker[1]
      Executing action method IdentityServerWithAspNetIdentity.Controllers.HomeController.Index (IdentityServerWithAspNetIdentity) with arguments ((null)) - ModelState is Valid
info: Microsoft.AspNetCore.Mvc.ViewFeatures.Internal.ViewResultExecutor[1]
      Executing ViewResult, running view at path /Views/Home/Index.cshtml.
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[8]
      AuthenticationScheme: Identity.Application was successfully authenticated.
info: Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker[2]
      Executed action IdentityServerWithAspNetIdentity.Controllers.HomeController.Index (IdentityServerWithAspNetIdentity) in 1972.407ms
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[2]
      Request finished in 2515.6542ms 200 text/html; charset=utf-8
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[1]
      Request starting HTTP/1.1 POST http://localhost:5000/Account/Logout application/x-www-form-urlencoded 225
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[3]
      HttpContext.User merged via AutomaticAuthentication from authenticationScheme: Identity.Application.
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[8]
      AuthenticationScheme: Identity.Application was successfully authenticated.
info: Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker[1]
      Executing action method IdentityServerWithAspNetIdentity.Controllers.AccountController.Logout (IdentityServerWithAspNetIdentity) with arguments (IdentityServer4.Quickstart.UI.LogoutViewModel) - ModelState is Valid
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[8]
      AuthenticationScheme: Identity.Application was successfully authenticated.
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[8]
      AuthenticationScheme: Identity.Application was successfully authenticated.
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[8]
      AuthenticationScheme: Identity.Application was successfully authenticated.
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[8]
      AuthenticationScheme: Identity.Application was successfully authenticated.
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[8]
      AuthenticationScheme: Identity.Application was successfully authenticated.
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[11]
      AuthenticationScheme: Identity.Application signed out.
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[11]
      AuthenticationScheme: Identity.External signed out.
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[11]
      AuthenticationScheme: Identity.TwoFactorUserId signed out.
info: Microsoft.AspNetCore.Mvc.ViewFeatures.Internal.ViewResultExecutor[1]
      Executing ViewResult, running view at path /Views/Account/LoggedOut.cshtml.
info: Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker[2]
      Executed action IdentityServerWithAspNetIdentity.Controllers.AccountController.Logout (IdentityServerWithAspNetIdentity) in 296.7715ms
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[2]
      Request finished in 316.8872ms 200 text/html; charset=utf-8
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[1]
      Request starting HTTP/1.1 GET http://localhost:5000/connect/endsession/callback?sid=5c922322b990f4ee304ffcc7477d8d52  
dbug: IdentityServer4.Hosting.EndpointRouter[0]
      Request path /connect/endsession/callback matched to endpoint type EndSession
dbug: IdentityServer4.Hosting.EndpointRouter[0]
      Mapping found for endpoint: EndSession, creating handler: IdentityServer4.Endpoints.EndSessionEndpoint
info: IdentityServer4.Hosting.IdentityServerMiddleware[0]
      Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionEndpoint for /connect/endsession/callback
dbug: IdentityServer4.Endpoints.EndSessionEndpoint[0]
      Processing signout callback request
dbug: IdentityServer4.Validation.EndSessionRequestValidator[0]
      No client end session iframe URLs
info: IdentityServer4.Endpoints.EndSessionEndpoint[0]
      Successful signout callback. Client logout iframe urls: 
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[2]
      Request finished in 53.2203ms 200 text/html; charset=UTF-8
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[1]
      Request starting HTTP/1.1 GET http://localhost:5000/Account/Login  
info: Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker[1]
      Executing action method IdentityServerWithAspNetIdentity.Controllers.AccountController.Login (IdentityServerWithAspNetIdentity) with arguments () - ModelState is Valid
info: Microsoft.AspNetCore.Mvc.ViewFeatures.Internal.ViewResultExecutor[1]
      Executing ViewResult, running view at path /Views/Account/Login.cshtml.
info: Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker[2]
      Executed action IdentityServerWithAspNetIdentity.Controllers.AccountController.Login (IdentityServerWithAspNetIdentity) in 376.4816ms
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[2]
      Request finished in 378.9769ms 200 text/html; charset=utf-8
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[1]
      Request starting HTTP/1.1 POST http://localhost:5000/Account/ExternalLogin application/x-www-form-urlencoded 198
info: Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker[1]
      Executing action method IdentityServerWithAspNetIdentity.Controllers.AccountController.ExternalLogin (IdentityServerWithAspNetIdentity) with arguments (Google, ) - ModelState is Valid
info: Microsoft.AspNetCore.Mvc.ChallengeResult[1]
      Executing ChallengeResult with authentication schemes (Google).
info: Microsoft.AspNetCore.Authentication.Google.GoogleMiddleware[12]
      AuthenticationScheme: Google was challenged.
info: Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker[2]
      Executed action IdentityServerWithAspNetIdentity.Controllers.AccountController.ExternalLogin (IdentityServerWithAspNetIdentity) in 31.6741ms
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[2]
      Request finished in 35.3421ms 302 
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[1]
      Request starting HTTP/1.1 GET http://localhost:5000/signin-google?state=CfDJ8HBkOc22RaNLlo9hq-ctYxBiAH4FDZtESSKW63CSbxo49xZam0IU1pGfYExHH7_l2a4ZbcEC_gare0BryTmsiUXC70YjQieAIFHgtB7lpD4DVwY4waZnkli6uz3Mbmokz7IXsEtq7-K5AqwXLsR8a4M1RGvoyvUa3nQ0ur4lJnwV-rl0yaKjXCRoXD2FKRtTdlmMUdO7a93z3MZ7TEGsjt0NUuuvqB9NW46GUMGu-IClDydTi994e8N35JC02OBOpsc7XVfyXKofB6nxUbY5NGY&code=4/EPw7-ghogRPIqLbUPQMRR7Ym_aDgftEk3Gf-KCtfkJk&authuser=0&session_state=8db11ed6eab6a212915a0fccc10a2c96eeeee61d..217e&prompt=none  
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[10]
      AuthenticationScheme: Identity.External signed in.
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[2]
      Request finished in 916.0441ms 302 
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[1]
      Request starting HTTP/1.1 GET http://localhost:5000/Account/ExternalLoginCallback  
info: Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker[1]
      Executing action method IdentityServerWithAspNetIdentity.Controllers.AccountController.ExternalLoginCallback (IdentityServerWithAspNetIdentity) with arguments (, ) - ModelState is Valid
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[8]
      AuthenticationScheme: Identity.External was successfully authenticated.
info: Microsoft.EntityFrameworkCore.Storage.IRelationalCommandBuilderFactory[1]
      Executed DbCommand (46ms) [Parameters=[@__get_Item_0='?' (Size = 450), @__get_Item_1='?' (Size = 450)], CommandType='Text', CommandTimeout='30']
      SELECT TOP(1) [e].[LoginProvider], [e].[ProviderKey], [e].[ProviderDisplayName], [e].[UserId]
      FROM [AspNetUserLogins] AS [e]
      WHERE ([e].[LoginProvider] = @__get_Item_0) AND ([e].[ProviderKey] = @__get_Item_1)
info: Microsoft.AspNetCore.Mvc.ViewFeatures.Internal.ViewResultExecutor[1]
      Executing ViewResult, running view at path /Views/Account/ExternalLoginConfirmation.cshtml.
info: Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker[2]
      Executed action IdentityServerWithAspNetIdentity.Controllers.AccountController.ExternalLoginCallback (IdentityServerWithAspNetIdentity) in 327.8392ms
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[2]
      Request finished in 329.7899ms 200 text/html; charset=utf-8
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[1]
      Request starting HTTP/1.1 POST http://localhost:5000/Account/ExternalLogin application/x-www-form-urlencoded 200
info: Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker[1]
      Executing action method IdentityServerWithAspNetIdentity.Controllers.AccountController.ExternalLogin (IdentityServerWithAspNetIdentity) with arguments (Facebook, ) - ModelState is Valid
info: Microsoft.AspNetCore.Mvc.ChallengeResult[1]
      Executing ChallengeResult with authentication schemes (Facebook).
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[8]
      AuthenticationScheme: Identity.External was successfully authenticated.
info: Microsoft.AspNetCore.Authentication.Facebook.FacebookMiddleware[12]
      AuthenticationScheme: Facebook was challenged.
info: Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker[2]
      Executed action IdentityServerWithAspNetIdentity.Controllers.AccountController.ExternalLogin (IdentityServerWithAspNetIdentity) in 4.6914ms
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[2]
      Request finished in 6.679ms 302 
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[1]
      Request starting HTTP/1.1 GET http://localhost:5000/signin-facebook?code=AQDUmvO1Z7ke6akm7zf9eq5VDO3EkJWlBy8MtYPKwUs886w-FapeDyXlhVruKWPfcWvCUJM7qbcUUkkWgR0H_YoqHVCw_J2RtWgv6E5rSQkvIcIBJMBXGd1s0YazZYCHx7cb6Ijnra7UoNy_SkgTKPu4s-3bMA0a-08qlrNBFftzGXQsdSWlI0BbftmlJssJ36t3GBEl2g702yD5b8GwzbJ0ox7Vex57ll-Z8IckIuhByg_Ko27dZBwVPzgtbvSr7-XyH48IvbCvOkD5ncrRhCxtBJyzIywrugKm8W_6wec7UGdLfqtKEElCakBsL-7_Q8DZ6WPrS8iT-dt1mVCdut40&state=CfDJ8HBkOc22RaNLlo9hq-ctYxB5CacD3z2VdFBmb7hJICsRBxvmSBB3fy1f726sg5Y_gcdD_8FrYQg-h9FgblVtZWD1BWuYPH7Ueu9pd_lf9xYTuwD0xBrPlTcM3GQikQysnF8XTXzg3NyiCqNu1TF8C_NOmz8_OMPF_N0s-76OnsTsKxxq0UPN76YO_0SxT2Y0Z1zfPZZsTs2ZXtVqy9--NpfnfBYa_eTZMVAEzIzEJbUXT2GzC-8iv5xPQbe347mJ7AzMqmFa_udwt0_lJv-J3CY  
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[10]
      AuthenticationScheme: Identity.External signed in.
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[2]
      Request finished in 582.7696ms 302 
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[1]
      Request starting HTTP/1.1 GET http://localhost:5000/Account/ExternalLoginCallback  
info: Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker[1]
      Executing action method IdentityServerWithAspNetIdentity.Controllers.AccountController.ExternalLoginCallback (IdentityServerWithAspNetIdentity) with arguments (, ) - ModelState is Valid
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[8]
      AuthenticationScheme: Identity.External was successfully authenticated.
info: Microsoft.EntityFrameworkCore.Storage.IRelationalCommandBuilderFactory[1]
      Executed DbCommand (2ms) [Parameters=[@__get_Item_0='?' (Size = 450), @__get_Item_1='?' (Size = 450)], CommandType='Text', CommandTimeout='30']
      SELECT TOP(1) [e].[LoginProvider], [e].[ProviderKey], [e].[ProviderDisplayName], [e].[UserId]
      FROM [AspNetUserLogins] AS [e]
      WHERE ([e].[LoginProvider] = @__get_Item_0) AND ([e].[ProviderKey] = @__get_Item_1)
info: Microsoft.AspNetCore.Mvc.ViewFeatures.Internal.ViewResultExecutor[1]
      Executing ViewResult, running view at path /Views/Account/ExternalLoginConfirmation.cshtml.
info: Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker[2]
      Executed action IdentityServerWithAspNetIdentity.Controllers.AccountController.ExternalLoginCallback (IdentityServerWithAspNetIdentity) in 14.3486ms
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[2]
      Request finished in 15.7304ms 200 text/html; charset=utf-8
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[1]
      Request starting HTTP/1.1 POST http://localhost:5000/Account/ExternalLoginConfirmation application/x-www-form-urlencoded 217
info: Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker[1]
      Executing action method IdentityServerWithAspNetIdentity.Controllers.AccountController.ExternalLoginConfirmation (IdentityServerWithAspNetIdentity) with arguments (IdentityServerWithAspNetIdentity.Models.AccountViewModels.ExternalLoginConfirmationViewModel, ) - ModelState is Valid
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[8]
      AuthenticationScheme: Identity.External was successfully authenticated.
info: Microsoft.EntityFrameworkCore.Storage.IRelationalCommandBuilderFactory[1]
      Executed DbCommand (1ms) [Parameters=[@__normalizedUserName_0='?' (Size = 256)], CommandType='Text', CommandTimeout='30']
      SELECT TOP(1) [u].[Id], [u].[AccessFailedCount], [u].[ConcurrencyStamp], [u].[Email], [u].[EmailConfirmed], [u].[LockoutEnabled], [u].[LockoutEnd], [u].[NormalizedEmail], [u].[NormalizedUserName], [u].[PasswordHash], [u].[PhoneNumber], [u].[PhoneNumberConfirmed], [u].[SecurityStamp], [u].[TwoFactorEnabled], [u].[UserName]
      FROM [AspNetUsers] AS [u]
      WHERE [u].[NormalizedUserName] = @__normalizedUserName_0
info: Microsoft.EntityFrameworkCore.Storage.IRelationalCommandBuilderFactory[1]
      Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 450), @p1='?', @p2='?' (Size = 4000), @p3='?' (Size = 256), @p4='?', @p5='?', @p6='?', @p7='?' (Size = 256), @p8='?' (Size = 256), @p9='?' (Size = 4000), @p10='?' (Size = 4000), @p11='?', @p12='?' (Size = 4000), @p13='?', @p14='?' (Size = 256)], CommandType='Text', CommandTimeout='30']
      SET NOCOUNT ON;
      INSERT INTO [AspNetUsers] ([Id], [AccessFailedCount], [ConcurrencyStamp], [Email], [EmailConfirmed], [LockoutEnabled], [LockoutEnd], [NormalizedEmail], [NormalizedUserName], [PasswordHash], [PhoneNumber], [PhoneNumberConfirmed], [SecurityStamp], [TwoFactorEnabled], [UserName])
      VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14);
info: Microsoft.EntityFrameworkCore.Storage.IRelationalCommandBuilderFactory[1]
      Executed DbCommand (1ms) [Parameters=[@__get_Item_0='?' (Size = 450), @__get_Item_1='?' (Size = 450)], CommandType='Text', CommandTimeout='30']
      SELECT TOP(1) [e].[LoginProvider], [e].[ProviderKey], [e].[ProviderDisplayName], [e].[UserId]
      FROM [AspNetUserLogins] AS [e]
      WHERE ([e].[LoginProvider] = @__get_Item_0) AND ([e].[ProviderKey] = @__get_Item_1)
info: Microsoft.EntityFrameworkCore.Storage.IRelationalCommandBuilderFactory[1]
      Executed DbCommand (1ms) [Parameters=[@__normalizedUserName_0='?' (Size = 256)], CommandType='Text', CommandTimeout='30']
      SELECT TOP(1) [u].[Id], [u].[AccessFailedCount], [u].[ConcurrencyStamp], [u].[Email], [u].[EmailConfirmed], [u].[LockoutEnabled], [u].[LockoutEnd], [u].[NormalizedEmail], [u].[NormalizedUserName], [u].[PasswordHash], [u].[PhoneNumber], [u].[PhoneNumberConfirmed], [u].[SecurityStamp], [u].[TwoFactorEnabled], [u].[UserName]
      FROM [AspNetUsers] AS [u]
      WHERE [u].[NormalizedUserName] = @__normalizedUserName_0
info: Microsoft.EntityFrameworkCore.Storage.IRelationalCommandBuilderFactory[1]
      Executed DbCommand (3ms) [Parameters=[@p0='?' (Size = 450), @p1='?' (Size = 450), @p2='?' (Size = 4000), @p3='?' (Size = 450), @p18='?' (Size = 450), @p4='?', @p5='?' (Size = 4000), @p19='?' (Size = 4000), @p6='?' (Size = 256), @p7='?', @p8='?', @p9='?', @p10='?' (Size = 256), @p11='?' (Size = 256), @p12='?' (Size = 4000), @p13='?' (Size = 4000), @p14='?', @p15='?' (Size = 4000), @p16='?', @p17='?' (Size = 256)], CommandType='Text', CommandTimeout='30']
      SET NOCOUNT ON;
      INSERT INTO [AspNetUserLogins] ([LoginProvider], [ProviderKey], [ProviderDisplayName], [UserId])
      VALUES (@p0, @p1, @p2, @p3);
      UPDATE [AspNetUsers] SET [AccessFailedCount] = @p4, [ConcurrencyStamp] = @p5, [Email] = @p6, [EmailConfirmed] = @p7, [LockoutEnabled] = @p8, [LockoutEnd] = @p9, [NormalizedEmail] = @p10, [NormalizedUserName] = @p11, [PasswordHash] = @p12, [PhoneNumber] = @p13, [PhoneNumberConfirmed] = @p14, [SecurityStamp] = @p15, [TwoFactorEnabled] = @p16, [UserName] = @p17
      WHERE [Id] = @p18 AND [ConcurrencyStamp] = @p19;
      SELECT @@ROWCOUNT;
info: Microsoft.EntityFrameworkCore.Storage.IRelationalCommandBuilderFactory[1]
      Executed DbCommand (8ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='Text', CommandTimeout='30']
      SELECT [role].[Name]
      FROM [AspNetUserRoles] AS [userRole]
      INNER JOIN [AspNetRoles] AS [role] ON [userRole].[RoleId] = [role].[Id]
      WHERE [userRole].[UserId] = @__userId_0
info: Microsoft.EntityFrameworkCore.Storage.IRelationalCommandBuilderFactory[1]
      Executed DbCommand (3ms) [Parameters=[@__user_Id_0='?' (Size = 450)], CommandType='Text', CommandTimeout='30']
      SELECT [uc].[Id], [uc].[ClaimType], [uc].[ClaimValue], [uc].[UserId]
      FROM [AspNetUserClaims] AS [uc]
      WHERE [uc].[UserId] = @__user_Id_0
dbug: IdentityServer4.Hosting.AuthenticationHandler[0]
      Augmenting SignInContext
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[10]
      AuthenticationScheme: Identity.Application signed in.
info: IdentityServerWithAspNetIdentity.Controllers.AccountController[6]
      User created an account using Facebook provider.
info: Microsoft.AspNetCore.Mvc.RedirectToActionResult[1]
      Executing RedirectResult, redirecting to /.
info: Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker[2]
      Executed action IdentityServerWithAspNetIdentity.Controllers.AccountController.ExternalLoginConfirmation (IdentityServerWithAspNetIdentity) in 420.4197ms
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[2]
      Request finished in 422.3689ms 302 
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[1]
      Request starting HTTP/1.1 GET http://localhost:5000/  
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[3]
      HttpContext.User merged via AutomaticAuthentication from authenticationScheme: Identity.Application.
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[8]
      AuthenticationScheme: Identity.Application was successfully authenticated.
info: Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker[1]
      Executing action method IdentityServerWithAspNetIdentity.Controllers.HomeController.Index (IdentityServerWithAspNetIdentity) with arguments ((null)) - ModelState is Valid
info: Microsoft.AspNetCore.Mvc.ViewFeatures.Internal.ViewResultExecutor[1]
      Executing ViewResult, running view at path /Views/Home/Index.cshtml.
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[8]
      AuthenticationScheme: Identity.Application was successfully authenticated.
info: Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker[2]
      Executed action IdentityServerWithAspNetIdentity.Controllers.HomeController.Index (IdentityServerWithAspNetIdentity) in 1.9621ms
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[2]
      Request finished in 3.7377ms 200 text/html; charset=utf-8
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[1]
      Request starting HTTP/1.1 POST http://localhost:5000/Account/Logout application/x-www-form-urlencoded 225
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[3]
      HttpContext.User merged via AutomaticAuthentication from authenticationScheme: Identity.Application.
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[8]
      AuthenticationScheme: Identity.Application was successfully authenticated.
info: Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker[1]
      Executing action method IdentityServerWithAspNetIdentity.Controllers.AccountController.Logout (IdentityServerWithAspNetIdentity) with arguments (IdentityServer4.Quickstart.UI.LogoutViewModel) - ModelState is Valid
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[8]
      AuthenticationScheme: Identity.Application was successfully authenticated.
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[8]
      AuthenticationScheme: Identity.Application was successfully authenticated.
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[8]
      AuthenticationScheme: Identity.Application was successfully authenticated.
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[8]
      AuthenticationScheme: Identity.Application was successfully authenticated.
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[8]
      AuthenticationScheme: Identity.Application was successfully authenticated.
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[11]
      AuthenticationScheme: Identity.Application signed out.
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[11]
      AuthenticationScheme: Identity.External signed out.
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[11]
      AuthenticationScheme: Identity.TwoFactorUserId signed out.
info: Microsoft.AspNetCore.Mvc.ViewFeatures.Internal.ViewResultExecutor[1]
      Executing ViewResult, running view at path /Views/Account/LoggedOut.cshtml.
info: Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker[2]
      Executed action IdentityServerWithAspNetIdentity.Controllers.AccountController.Logout (IdentityServerWithAspNetIdentity) in 5.2553ms
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[2]
      Request finished in 7.3652ms 200 text/html; charset=utf-8
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[1]
      Request starting HTTP/1.1 GET http://localhost:5000/connect/endsession/callback?sid=0bc957461de25d14e5da7dbe91dae21f  
dbug: IdentityServer4.Hosting.EndpointRouter[0]
      Request path /connect/endsession/callback matched to endpoint type EndSession
dbug: IdentityServer4.Hosting.EndpointRouter[0]
      Mapping found for endpoint: EndSession, creating handler: IdentityServer4.Endpoints.EndSessionEndpoint
info: IdentityServer4.Hosting.IdentityServerMiddleware[0]
      Invoking IdentityServer endpoint: IdentityServer4.Endpoints.EndSessionEndpoint for /connect/endsession/callback
dbug: IdentityServer4.Endpoints.EndSessionEndpoint[0]
      Processing signout callback request
dbug: IdentityServer4.Validation.EndSessionRequestValidator[0]
      No client end session iframe URLs
info: IdentityServer4.Endpoints.EndSessionEndpoint[0]
      Successful signout callback. Client logout iframe urls: 
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[2]
      Request finished in 18.1398ms 200 text/html; charset=UTF-8
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[1]
      Request starting HTTP/1.1 GET http://localhost:5000/Account/Login  
info: Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker[1]
      Executing action method IdentityServerWithAspNetIdentity.Controllers.AccountController.Login (IdentityServerWithAspNetIdentity) with arguments () - ModelState is Valid
info: Microsoft.AspNetCore.Mvc.ViewFeatures.Internal.ViewResultExecutor[1]
      Executing ViewResult, running view at path /Views/Account/Login.cshtml.
info: Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker[2]
      Executed action IdentityServerWithAspNetIdentity.Controllers.AccountController.Login (IdentityServerWithAspNetIdentity) in 4.499ms
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[2]
      Request finished in 6.8503ms 200 text/html; charset=utf-8
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[1]
      Request starting HTTP/1.1 POST http://localhost:5000/Account/ExternalLogin application/x-www-form-urlencoded 200
info: Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker[1]
      Executing action method IdentityServerWithAspNetIdentity.Controllers.AccountController.ExternalLogin (IdentityServerWithAspNetIdentity) with arguments (Facebook, ) - ModelState is Valid
info: Microsoft.AspNetCore.Mvc.ChallengeResult[1]
      Executing ChallengeResult with authentication schemes (Facebook).
info: Microsoft.AspNetCore.Authentication.Facebook.FacebookMiddleware[12]
      AuthenticationScheme: Facebook was challenged.
info: Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker[2]
      Executed action IdentityServerWithAspNetIdentity.Controllers.AccountController.ExternalLogin (IdentityServerWithAspNetIdentity) in 0.6598ms
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[2]
      Request finished in 1.4776ms 302 
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[1]
      Request starting HTTP/1.1 GET http://localhost:5000/signin-facebook?code=AQDUClruNNi5hTAolsjZIiKRdIoUQRTcZGQCto9N6gvtCZ3sSkOuH87sXpkavr_dwqScxfznN-do5X6BcElpF4ZYuID_cjMHlGNmQcoIvJW3lnf3ggQV9JXlVWZuTDJTmvf3dnMCFVVHeky03xfltAEDiRf2iCwqknc_OFcZb7i9dNcM8zBOBcyLcfTn1zoQHqHcqoWDqFaevHRCn1RPGf4gqROJxgPopZSEIhGD2BBLEebAA7wgBW6tH77Nd2n6vrnC6gK97phU5nU9GaCFL-P-3WM4W5NG9F3NBtzLNqJNUW3ie35d707Ar-RjupH8rXqO0YRVilx46PwsfrXbMqWV&state=CfDJ8HBkOc22RaNLlo9hq-ctYxBc0jxQIQ96tjiSgv3n1l6bX-cGjgmF6wBbjEQKyhM4pc_lquKUR4vk-YpgJ0lw92w3tqcEtvKJu240U6pJqTES4lT-SsBM8yVb-FkYfNBMciyGSESDeGLep8WWVicjnGs_74DC_ZSvInMlhFCb0ILXgIq7f4AtTbHi2Pjq_33zzGUObEWi96RpSEC9CrfbbLF0Qi-GGxtPeMA6465eLJKn5h0X0UE_EYpH6qXWH0rM-BdzEBfzcXGqNx3YIfxHmEk  
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[10]
      AuthenticationScheme: Identity.External signed in.
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[2]
      Request finished in 579.2022ms 302 
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[1]
      Request starting HTTP/1.1 GET http://localhost:5000/Account/ExternalLoginCallback  
info: Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker[1]
      Executing action method IdentityServerWithAspNetIdentity.Controllers.AccountController.ExternalLoginCallback (IdentityServerWithAspNetIdentity) with arguments (, ) - ModelState is Valid
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[8]
      AuthenticationScheme: Identity.External was successfully authenticated.
info: Microsoft.EntityFrameworkCore.Storage.IRelationalCommandBuilderFactory[1]
      Executed DbCommand (1ms) [Parameters=[@__get_Item_0='?' (Size = 450), @__get_Item_1='?' (Size = 450)], CommandType='Text', CommandTimeout='30']
      SELECT TOP(1) [e].[LoginProvider], [e].[ProviderKey], [e].[ProviderDisplayName], [e].[UserId]
      FROM [AspNetUserLogins] AS [e]
      WHERE ([e].[LoginProvider] = @__get_Item_0) AND ([e].[ProviderKey] = @__get_Item_1)
info: Microsoft.AspNetCore.Mvc.ViewFeatures.Internal.ViewResultExecutor[1]
      Executing ViewResult, running view at path /Views/Account/ExternalLoginConfirmation.cshtml.
info: Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker[2]
      Executed action IdentityServerWithAspNetIdentity.Controllers.AccountController.ExternalLoginCallback (IdentityServerWithAspNetIdentity) in 4.9101ms
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[2]
      Request finished in 6.5265ms 200 text/html; charset=utf-8
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[1]
      Request starting HTTP/1.1 POST http://localhost:5000/Account/ExternalLoginConfirmation application/x-www-form-urlencoded 217
info: Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker[1]
      Executing action method IdentityServerWithAspNetIdentity.Controllers.AccountController.ExternalLoginConfirmation (IdentityServerWithAspNetIdentity) with arguments (IdentityServerWithAspNetIdentity.Models.AccountViewModels.ExternalLoginConfirmationViewModel, ) - ModelState is Valid
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[8]
      AuthenticationScheme: Identity.External was successfully authenticated.
info: Microsoft.EntityFrameworkCore.Storage.IRelationalCommandBuilderFactory[1]
      Executed DbCommand (1ms) [Parameters=[@__normalizedUserName_0='?' (Size = 256)], CommandType='Text', CommandTimeout='30']
      SELECT TOP(1) [u].[Id], [u].[AccessFailedCount], [u].[ConcurrencyStamp], [u].[Email], [u].[EmailConfirmed], [u].[LockoutEnabled], [u].[LockoutEnd], [u].[NormalizedEmail], [u].[NormalizedUserName], [u].[PasswordHash], [u].[PhoneNumber], [u].[PhoneNumberConfirmed], [u].[SecurityStamp], [u].[TwoFactorEnabled], [u].[UserName]
      FROM [AspNetUsers] AS [u]
      WHERE [u].[NormalizedUserName] = @__normalizedUserName_0
warn: Microsoft.AspNetCore.Identity.UserManager[13]
      User 0e0102f3-9010-405e-aa5b-c01528c9fee0 validation failed: DuplicateUserName.
info: Microsoft.AspNetCore.Mvc.ViewFeatures.Internal.ViewResultExecutor[1]
      Executing ViewResult, running view at path /Views/Account/ExternalLoginConfirmation.cshtml.
info: Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker[2]
      Executed action IdentityServerWithAspNetIdentity.Controllers.AccountController.ExternalLoginConfirmation (IdentityServerWithAspNetIdentity) in 19.5245ms
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[2]
      Request finished in 21.0649ms 200 text/html; charset=utf-8
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[1]
      Request starting HTTP/1.1 POST http://localhost:5000/Account/ExternalLoginConfirmation application/x-www-form-urlencoded 217
info: Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker[1]
      Executing action method IdentityServerWithAspNetIdentity.Controllers.AccountController.ExternalLoginConfirmation (IdentityServerWithAspNetIdentity) with arguments (IdentityServerWithAspNetIdentity.Models.AccountViewModels.ExternalLoginConfirmationViewModel, ) - ModelState is Valid
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[8]
      AuthenticationScheme: Identity.External was successfully authenticated.
info: Microsoft.EntityFrameworkCore.Storage.IRelationalCommandBuilderFactory[1]
      Executed DbCommand (2ms) [Parameters=[@__normalizedUserName_0='?' (Size = 256)], CommandType='Text', CommandTimeout='30']
      SELECT TOP(1) [u].[Id], [u].[AccessFailedCount], [u].[ConcurrencyStamp], [u].[Email], [u].[EmailConfirmed], [u].[LockoutEnabled], [u].[LockoutEnd], [u].[NormalizedEmail], [u].[NormalizedUserName], [u].[PasswordHash], [u].[PhoneNumber], [u].[PhoneNumberConfirmed], [u].[SecurityStamp], [u].[TwoFactorEnabled], [u].[UserName]
      FROM [AspNetUsers] AS [u]
      WHERE [u].[NormalizedUserName] = @__normalizedUserName_0
info: Microsoft.EntityFrameworkCore.Storage.IRelationalCommandBuilderFactory[1]
      Executed DbCommand (2ms) [Parameters=[@p0='?' (Size = 450), @p1='?', @p2='?' (Size = 4000), @p3='?' (Size = 256), @p4='?', @p5='?', @p6='?', @p7='?' (Size = 256), @p8='?' (Size = 256), @p9='?' (Size = 4000), @p10='?' (Size = 4000), @p11='?', @p12='?' (Size = 4000), @p13='?', @p14='?' (Size = 256)], CommandType='Text', CommandTimeout='30']
      SET NOCOUNT ON;
      INSERT INTO [AspNetUsers] ([Id], [AccessFailedCount], [ConcurrencyStamp], [Email], [EmailConfirmed], [LockoutEnabled], [LockoutEnd], [NormalizedEmail], [NormalizedUserName], [PasswordHash], [PhoneNumber], [PhoneNumberConfirmed], [SecurityStamp], [TwoFactorEnabled], [UserName])
      VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7, @p8, @p9, @p10, @p11, @p12, @p13, @p14);
info: Microsoft.EntityFrameworkCore.Storage.IRelationalCommandBuilderFactory[1]
      Executed DbCommand (2ms) [Parameters=[@__get_Item_0='?' (Size = 450), @__get_Item_1='?' (Size = 450)], CommandType='Text', CommandTimeout='30']
      SELECT TOP(1) [e].[LoginProvider], [e].[ProviderKey], [e].[ProviderDisplayName], [e].[UserId]
      FROM [AspNetUserLogins] AS [e]
      WHERE ([e].[LoginProvider] = @__get_Item_0) AND ([e].[ProviderKey] = @__get_Item_1)
info: Microsoft.EntityFrameworkCore.Storage.IRelationalCommandBuilderFactory[1]
      Executed DbCommand (1ms) [Parameters=[@__normalizedUserName_0='?' (Size = 256)], CommandType='Text', CommandTimeout='30']
      SELECT TOP(1) [u].[Id], [u].[AccessFailedCount], [u].[ConcurrencyStamp], [u].[Email], [u].[EmailConfirmed], [u].[LockoutEnabled], [u].[LockoutEnd], [u].[NormalizedEmail], [u].[NormalizedUserName], [u].[PasswordHash], [u].[PhoneNumber], [u].[PhoneNumberConfirmed], [u].[SecurityStamp], [u].[TwoFactorEnabled], [u].[UserName]
      FROM [AspNetUsers] AS [u]
      WHERE [u].[NormalizedUserName] = @__normalizedUserName_0
info: Microsoft.EntityFrameworkCore.Storage.IRelationalCommandBuilderFactory[1]
      Executed DbCommand (1ms) [Parameters=[@p0='?' (Size = 450), @p1='?' (Size = 450), @p2='?' (Size = 4000), @p3='?' (Size = 450), @p18='?' (Size = 450), @p4='?', @p5='?' (Size = 4000), @p19='?' (Size = 4000), @p6='?' (Size = 256), @p7='?', @p8='?', @p9='?', @p10='?' (Size = 256), @p11='?' (Size = 256), @p12='?' (Size = 4000), @p13='?' (Size = 4000), @p14='?', @p15='?' (Size = 4000), @p16='?', @p17='?' (Size = 256)], CommandType='Text', CommandTimeout='30']
      SET NOCOUNT ON;
      INSERT INTO [AspNetUserLogins] ([LoginProvider], [ProviderKey], [ProviderDisplayName], [UserId])
      VALUES (@p0, @p1, @p2, @p3);
      UPDATE [AspNetUsers] SET [AccessFailedCount] = @p4, [ConcurrencyStamp] = @p5, [Email] = @p6, [EmailConfirmed] = @p7, [LockoutEnabled] = @p8, [LockoutEnd] = @p9, [NormalizedEmail] = @p10, [NormalizedUserName] = @p11, [PasswordHash] = @p12, [PhoneNumber] = @p13, [PhoneNumberConfirmed] = @p14, [SecurityStamp] = @p15, [TwoFactorEnabled] = @p16, [UserName] = @p17
      WHERE [Id] = @p18 AND [ConcurrencyStamp] = @p19;
      SELECT @@ROWCOUNT;
info: Microsoft.EntityFrameworkCore.Storage.IRelationalCommandBuilderFactory[1]
      Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (Size = 450)], CommandType='Text', CommandTimeout='30']
      SELECT [role].[Name]
      FROM [AspNetUserRoles] AS [userRole]
      INNER JOIN [AspNetRoles] AS [role] ON [userRole].[RoleId] = [role].[Id]
      WHERE [userRole].[UserId] = @__userId_0
info: Microsoft.EntityFrameworkCore.Storage.IRelationalCommandBuilderFactory[1]
      Executed DbCommand (1ms) [Parameters=[@__user_Id_0='?' (Size = 450)], CommandType='Text', CommandTimeout='30']
      SELECT [uc].[Id], [uc].[ClaimType], [uc].[ClaimValue], [uc].[UserId]
      FROM [AspNetUserClaims] AS [uc]
      WHERE [uc].[UserId] = @__user_Id_0
dbug: IdentityServer4.Hosting.AuthenticationHandler[0]
      Augmenting SignInContext
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[10]
      AuthenticationScheme: Identity.Application signed in.
info: IdentityServerWithAspNetIdentity.Controllers.AccountController[6]
      User created an account using Facebook provider.
info: Microsoft.AspNetCore.Mvc.RedirectToActionResult[1]
      Executing RedirectResult, redirecting to /.
info: Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker[2]
      Executed action IdentityServerWithAspNetIdentity.Controllers.AccountController.ExternalLoginConfirmation (IdentityServerWithAspNetIdentity) in 34.2679ms
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[2]
      Request finished in 35.4541ms 302 
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[1]
      Request starting HTTP/1.1 GET http://localhost:5000/  
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[3]
      HttpContext.User merged via AutomaticAuthentication from authenticationScheme: Identity.Application.
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[8]
      AuthenticationScheme: Identity.Application was successfully authenticated.
info: Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker[1]
      Executing action method IdentityServerWithAspNetIdentity.Controllers.HomeController.Index (IdentityServerWithAspNetIdentity) with arguments ((null)) - ModelState is Valid
info: Microsoft.AspNetCore.Mvc.ViewFeatures.Internal.ViewResultExecutor[1]
      Executing ViewResult, running view at path /Views/Home/Index.cshtml.
info: Microsoft.AspNetCore.Authentication.Cookies.CookieAuthenticationMiddleware[8]
      AuthenticationScheme: Identity.Application was successfully authenticated.
info: Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker[2]
      Executed action IdentityServerWithAspNetIdentity.Controllers.HomeController.Index (IdentityServerWithAspNetIdentity) in 2.9597ms
info: Microsoft.AspNetCore.Hosting.Internal.WebHost[2]
      Request finished in 4.7981ms 200 text/html; charset=utf-8
